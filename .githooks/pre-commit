#!/bin/bash
# Pre-commit hook for Arnova Next.js + Django project

echo "ğŸ” Running pre-commit checks..."

# Format Python files
echo "ğŸ Formatting Python files..."
black . --exclude="/(migrations|venv|.venv|node_modules|.next)/" 2>/dev/null || echo "Black not available"
isort . --skip=migrations --skip=venv --skip=.venv --skip=node_modules --skip=.next 2>/dev/null || echo "isort not available"

# Format JavaScript/TypeScript files
echo "âš›ï¸ Formatting JS/TS files..."
npx prettier --write "**/*.{js,jsx,ts,tsx,json,css,md}" --ignore-path .gitignore 2>/dev/null || echo "Prettier not available"

# Check if there are any changes after formatting
if ! git diff --quiet; then
    echo "ğŸ“ Files were formatted. Please review and commit again."
    exit 1
fi

# Run linting
echo "ğŸ”§ Running linters..."
flake8 . --exclude=migrations,venv,.venv,node_modules,.next --max-line-length=88 --extend-ignore=E203 2>/dev/null || echo "flake8 not available"
npm run lint 2>/dev/null || echo "ESLint not available"

# Check for trailing whitespace
if git diff --cached --check; then
    echo "âœ… Trailing whitespace check passed"
else
    echo "âŒ Please fix trailing whitespace"
    exit 1
fi

echo "âœ… Pre-commit checks passed"
exit 0